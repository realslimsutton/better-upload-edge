{"name":"upload-dropzone-progress","title":"Upload Dropzone with Progress","type":"registry:component","dependencies":["better-upload","lucide-react","react-dropzone"],"registryDependencies":["progress"],"files":[{"path":"registry/better-upload/upload-dropzone-progress.tsx","type":"registry:component","content":"import { Progress } from '@/components/ui/progress';\r\nimport { cn } from '@/lib/utils';\r\nimport type { UploadHookControl } from 'better-upload/client';\r\nimport { formatBytes } from 'better-upload/client/helpers';\r\nimport { Dot, File, Upload } from 'lucide-react';\r\nimport { useId } from 'react';\r\nimport { useDropzone } from 'react-dropzone';\r\n\r\ntype UploadDropzoneProgressProps = {\r\n  control: UploadHookControl<true>;\r\n  accept?: string;\r\n  metadata?: Record<string, unknown>;\r\n  description?:\r\n    | {\r\n        fileTypes?: string;\r\n        maxFileSize?: string;\r\n        maxFiles?: number;\r\n      }\r\n    | string;\r\n  uploadOverride?: (\r\n    ...args: Parameters<UploadHookControl<true>['upload']>\r\n  ) => void;\r\n\r\n  // Add any additional props you need.\r\n};\r\n\r\nexport function UploadDropzoneProgress({\r\n  control: { upload, isPending, progresses },\r\n  accept,\r\n  metadata,\r\n  description,\r\n  uploadOverride,\r\n}: UploadDropzoneProgressProps) {\r\n  const id = useId();\r\n\r\n  const { getRootProps, getInputProps, isDragActive, inputRef } = useDropzone({\r\n    onDrop: (files) => {\r\n      if (files.length > 0) {\r\n        if (uploadOverride) {\r\n          uploadOverride(files, { metadata });\r\n        } else {\r\n          upload(files, { metadata });\r\n        }\r\n      }\r\n      inputRef.current.value = '';\r\n    },\r\n    noClick: true,\r\n  });\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-3\">\r\n      <div\r\n        className={cn(\r\n          'relative rounded-lg border border-dashed transition-colors',\r\n          {\r\n            'border-primary/70': isDragActive,\r\n          }\r\n        )}\r\n      >\r\n        <label\r\n          {...getRootProps()}\r\n          className={cn(\r\n            'dark:bg-input/10 flex w-full min-w-72 cursor-pointer flex-col items-center justify-center rounded-lg bg-transparent px-2 py-6 transition-colors',\r\n            {\r\n              'text-muted-foreground cursor-not-allowed': isPending,\r\n              'hover:bg-accent dark:hover:bg-accent/30': !isPending,\r\n            }\r\n          )}\r\n          htmlFor={id}\r\n        >\r\n          <div className=\"my-2\">\r\n            <Upload className=\"size-6\" />\r\n          </div>\r\n\r\n          <div className=\"mt-3 space-y-1 text-center\">\r\n            <p className=\"text-sm font-semibold\">Drag and drop files here</p>\r\n\r\n            <p className=\"text-muted-foreground max-w-64 text-xs\">\r\n              {typeof description === 'string' ? (\r\n                description\r\n              ) : (\r\n                <>\r\n                  {description?.maxFiles &&\r\n                    `You can upload ${description.maxFiles} file${description.maxFiles !== 1 ? 's' : ''}.`}{' '}\r\n                  {description?.maxFileSize &&\r\n                    `${description.maxFiles !== 1 ? 'Each u' : 'U'}p to ${description.maxFileSize}.`}{' '}\r\n                  {description?.fileTypes &&\r\n                    `Accepted ${description.fileTypes}.`}\r\n                </>\r\n              )}\r\n            </p>\r\n          </div>\r\n\r\n          <input\r\n            {...getInputProps()}\r\n            type=\"file\"\r\n            multiple\r\n            id={id}\r\n            accept={accept}\r\n            disabled={isPending}\r\n          />\r\n        </label>\r\n\r\n        {isDragActive && (\r\n          <div className=\"bg-background pointer-events-none absolute inset-0 rounded-lg\">\r\n            <div className=\"dark:bg-accent/30 bg-accent flex size-full flex-col items-center justify-center rounded-lg\">\r\n              <div className=\"my-2\">\r\n                <Upload className=\"size-6\" />\r\n              </div>\r\n\r\n              <p className=\"mt-3 text-sm font-semibold\">Drop files here</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"grid gap-2\">\r\n        {progresses.map((progress) => (\r\n          <div\r\n            key={progress.objectKey}\r\n            className={cn(\r\n              'dark:bg-input/10 flex items-center gap-2 rounded-lg border bg-transparent p-3',\r\n              {\r\n                'bg-red-500/[0.04]! border-red-500/60':\r\n                  progress.status === 'failed',\r\n              }\r\n            )}\r\n          >\r\n            <FileIcon type={progress.type} />\r\n\r\n            <div className=\"grid grow gap-1\">\r\n              <div className=\"flex items-center gap-0.5\">\r\n                <p className=\"max-w-40 truncate text-sm font-medium\">\r\n                  {progress.name}\r\n                </p>\r\n                <Dot className=\"text-muted-foreground size-4\" />\r\n                <p className=\"text-muted-foreground text-xs\">\r\n                  {formatBytes(progress.size)}\r\n                </p>\r\n              </div>\r\n\r\n              <div className=\"flex h-4 items-center\">\r\n                {progress.progress < 1 && progress.status !== 'failed' ? (\r\n                  <Progress className=\"h-1.5\" value={progress.progress * 100} />\r\n                ) : progress.status === 'failed' ? (\r\n                  <p className=\"text-xs text-red-500\">Failed</p>\r\n                ) : (\r\n                  <p className=\"text-muted-foreground text-xs\">Completed</p>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst iconCaptions = {\r\n  'image/': 'IMG',\r\n  'video/': 'VID',\r\n  'audio/': 'AUD',\r\n  'application/pdf': 'PDF',\r\n  'application/zip': 'ZIP',\r\n  'application/x-rar-compressed': 'RAR',\r\n  'application/x-7z-compressed': '7Z',\r\n  'application/x-tar': 'TAR',\r\n  'application/json': 'JSON',\r\n  'application/javascript': 'JS',\r\n  'text/plain': 'TXT',\r\n  'text/csv': 'CSV',\r\n  'text/html': 'HTML',\r\n  'text/css': 'CSS',\r\n  'application/xml': 'XML',\r\n  'application/x-sh': 'SH',\r\n  'application/x-python-code': 'PY',\r\n  'application/x-executable': 'EXE',\r\n  'application/x-disk-image': 'ISO',\r\n};\r\n\r\nfunction FileIcon({ type }: { type: string }) {\r\n  const caption = Object.entries(iconCaptions).find(([key]) =>\r\n    type.startsWith(key)\r\n  )?.[1];\r\n\r\n  return (\r\n    <div className=\"relative shrink-0\">\r\n      <File className=\"text-muted-foreground size-12\" strokeWidth={1} />\r\n\r\n      {caption && (\r\n        <span className=\"bg-primary text-primary-foreground absolute bottom-2.5 left-0.5 select-none rounded px-1 py-px text-xs font-semibold\">\r\n          {caption}\r\n        </span>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"}]}